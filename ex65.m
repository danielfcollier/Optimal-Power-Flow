%
% Sistema equivalente Sul-Sudeste - 65 barras
%
%
warning off
nb=65;                         % number of busses 
nl=97;                         % number of lines 
biv=[1:nb]';                   % bus index vector
liv=[1:nl]';                   % line index vector

% line data
ldata=[
%[     r         x         b        nsb'     neb'       a]    
         0    0.0105         0    4.0000    2.0000    1.0100
    0.0017    0.0272    1.1570    4.0000    5.0000         1
    0.0017    0.0270    1.1510    4.0000    5.0000         1
    0.0021    0.0294    1.2730    4.0000   12.0000         1
         0    0.0236         0    4.0000   13.0000    1.0000
    0.0015    0.0240    1.0190    4.0000   27.0000         1
    0.0016    0.0246    1.0425    5.0000    6.0000         1
    0.0015    0.0239    1.0130    5.0000    7.0000         1
         0    0.0240         0    6.0000    9.0000    1.0000
    0.0011    0.0191    0.8093    6.0000   63.0000         1
         0    0.0242         0    7.0000   11.0000    1.0000
    0.0020    0.0310    1.3245    8.0000    7.0000         1
    0.0005    0.0082    0.3468    8.0000   63.0000         1
         0    0.0071         0   10.0000    3.0000    1.0000
    0.0010    0.0162    0.6817   10.0000    7.0000         1
    0.0010    0.0162    0.6817   10.0000    7.0000         1
         0    0.0080         0   12.0000    1.0000    1.0000
         0    0.0172         0   12.0000   14.0000    1.0000
         0    0.0172         0   12.0000   14.0000    1.0000
    0.0015    0.0232    0.9830   12.0000   25.0000         1
    0.0028    0.0399    1.7768   15.0000   12.0000         1
    0.0027    0.0387    1.7201   15.0000   21.0000         1
         0    0.0111         0   16.0000   15.0000    1.0000
         0    0.0100         0   16.0000   15.0000    1.0000
    0.0013    0.0194    0.7498   21.0000   12.0000         1
         0    0.0102         0   21.0000   17.0000    1.0000
    0.0008    0.0126    0.4950   21.0000   24.0000         1
         0    0.0263         0   22.0000   18.0000    1.0000
         0    0.0216         0   22.0000   23.0000    1.0000
         0    0.0216         0   22.0000   23.0000    1.0000
    0.0010    0.0152    0.5984   22.0000   24.0000         1
    0.0028    0.0484    2.0975   22.0000   25.0000         1
         0    0.0194         0   24.0000   19.0000    1.0000
         0    0.0070         0   25.0000   20.0000    1.0000
    0.0009    0.0138    0.5615   25.0000   27.0000         1
         0    0.0082         0   27.0000   26.0000    1.0000
         0    0.0142         0   28.0000   27.0000    1.0000
    0.0003    0.0115         0   32.0000   39.0000    1.0000
    0.0003    0.0117         0   32.0000   39.0000    1.0000
         0    0.0112         0   33.0000   29.0000    1.0000
    0.0001    0.0012    0.0760   33.0000   47.0000         1
    0.0001    0.0013    0.0771   33.0000   47.0000         1
    0.0244    0.1265    0.1085   34.0000   48.0000         1
         0    0.0664         0   35.0000   36.0000    1.0000
         0    0.0629         0   35.0000   36.0000    1.0000
         0    0.0670         0   35.0000   36.0000    1.0000
    0.0113    0.0699    0.0631   35.0000   42.0000         1
    0.0122    0.0769    0.0691   35.0000   60.0000         1
    0.0022    0.0109    0.0093   35.0000   65.0000         1
    0.0017    0.0103    0.0103   35.0000   65.0000         1
         0    0.0105         0   38.0000   31.0000    1.0000
    0.0005    0.0065    0.4025   38.0000   47.0000         1
    0.0006    0.0070    0.4287   38.0000   61.0000         1
    0.0031    0.0396    2.2242   39.0000   10.0000         1
    0.0031    0.0396    2.2242   39.0000   10.0000         1
    0.0005    0.0073    0.3903   40.0000   41.0000         1
         0    0.0102         0   41.0000   30.0000    1.0000
         0    0.0636         0   42.0000   37.0000    1.0000
    0.0015    0.0089    0.0082   42.0000   60.0000         1
    0.0020    0.0255    1.5636   47.0000   39.0000         1
    0.0016    0.0205    1.2509   47.0000   51.0000         1
    0.0020    0.0269    1.6820   47.0000   52.0000         1
    0.0003    0.0121         0   48.0000   47.0000    1.0000
    0.0304    0.1574    0.1356   48.0000   60.0000         1
    0.0304    0.1572    0.1354   48.0000   60.0000         1
    0.0026    0.0292    1.8020   49.0000   51.0000         1
    0.0013    0.0160    0.9794   49.0000   52.0000         1
    0.0003    0.0115         0   50.0000   49.0000    1.0000
    0.0003    0.0116         0   50.0000   49.0000    1.0000
         0    0.0128         0   50.0000   49.0000    1.0000
    0.0127    0.0656    0.0565   50.0000   58.0000         1
    0.0128    0.0656    0.0576   50.0000   58.0000         1
    0.0019    0.0235    1.4362   51.0000   54.0000         1
    0.0005    0.0044    0.2379   52.0000   39.0000         1
    0.0221    0.1147    0.0984   53.0000   34.0000         1
    0.0003    0.0116         0   53.0000   52.0000    1.0000
    0.0003    0.0117         0   53.0000   52.0000    1.0000
    0.0189    0.0978    0.0842   53.0000   58.0000         1
    0.0190    0.0970    0.0851   53.0000   58.0000         1
    0.0007    0.0092    0.5608   54.0000   56.0000         1
    0.0002    0.0121         0   55.0000   54.0000    1.0000
    0.0002    0.0123         0   55.0000   54.0000    1.0000
    0.0028    0.0385    2.4685   56.0000   57.0000         1
    0.0001    0.0154         0   57.0000   43.0000    1.0000
    0.0016    0.0303    1.7744   57.0000   54.0000         1
    0.0007    0.0092    0.5613   57.0000   59.0000         1
    0.0017    0.0217    1.3258   57.0000   61.0000         1
         0    0.0413         0   59.0000   44.0000    1.0000
    0.0005    0.0059    0.3591   59.0000   51.0000         1
    0.0002    0.0170         0   60.0000   45.0000    1.0000
    0.0008    0.0117    0.6229   61.0000   41.0000         1
    0.0001    0.0151         0   61.0000   46.0000    1.0000
    0.0003    0.0122         0   62.0000   56.0000    1.0000
    0.0004    0.0114         0   62.0000   56.0000    1.0000
    0.0004    0.0122         0   62.0000   56.0000    1.0000
         0    0.0520         0   63.0000   64.0000    1.0000
         0    0.0127         0   65.0000   40.0000    1.0000];
         
ifrom=ldata(:,4);             % origin index vector
ito=ldata(:,5);               % destiny index vector

r=ldata(:,1);                 % line resistance vector
x=ldata(:,2);                 % line reactance vector
bli=2*ldata(:,3);             % line shunt vector
a=ldata(:,6);                 % transformer ratio

phi=zeros(nl,1);             

% bus data
bdata=[
%[       pd        qd      shunt]
         0         0         0
         0         0         0
         0         0         0
         0         0         0
         0         0         0
         0         0         0
         0         0         0
   12.0000    1.5000         0
    0.7000    0.1000         0
    2.0000    0.3800         0
    4.4000    1.6000         0
         0         0         0
    0.7500    0.2500         0
    4.5400    0.4800         0
         0         0         0
   10.0000    3.5000         0
         0         0         0
         0         0         0
         0         0         0
         0         0         0
         0         0         0
         0         0         0
    1.1400    0.2400         0
         0         0         0
         0         0         0
         0         0         0
         0         0         0
    7.5000    1.7000         0
         0         0         0
         0         0         0
         0         0         0
    7.3540    1.9100         0
         0         0         0
    0.1340    0.0420         0
         0         0         0
    1.5900    0.3600         0
    0.9400    0.1800         0
         0         0         0
         0         0         0
         0         0         0
         0         0         0
         0         0         0
         0         0         0
         0         0         0
         0         0         0
         0         0         0
         0         0         0
    2.3700    0.5900         0
         0         0         0
   11.4900    0.5306         0
         0         0         0
         0         0    1.0000
    8.4470    4.6910         0
         0         0         0
    7.5560    0.5624         0
         0         0         0
         0         0         0
    0.7000    0.0200         0
         0         0         0
         0         0         0
         0         0         0
   12.2800    4.2500         0
         0         0         0
    1.1000    0.4300         0
    4.0300    1.2600         0];

fc=0.85;                      % load factor
pd=fc*bdata(:,1);             % active load vector
qd=fc*bdata(:,2);             % reactive load vector 
bmax=bdata(:,3);             % shunt compensation vector
bmin=bdata(:,3);

% generators data
nm=sparse(zeros(nb,1));       % número de máquinas em cada barra
sn=[];
fp=[];
xs=[];
qmax=[];
bb=zeros(nb,1);
aa=zeros(nb,1);

% UHE Itumbiara
nm(1)=4;                      % max=6
aux1=[3.84 3.82 3.80 3.78 3.76 3.74];
aux2=0.975*ones(1,6);
aux3=[0.78 0.76 0.74 0.72 0.70 0.68];
n=nm(1);
sn=[sn aux1(1:n)];
fp=[fp aux2(1:n)];
xs=[xs aux3(1:n)];
aa(1)=1;
bb(1)=1;

% UHE Marimbondo
nm(2)=6;                      % max=8   
n=nm(2,1);
aux1=[1.98 1.96 1.94 1.96 2.00 1.98 1.86 1.84];
aux2=0.975*ones(1,8);
aux3=[1.20 1.18 1.16 1.14 1.12 1.10 1.08 1.06];
sn=[sn aux1(1:n)];
fp=[fp aux2(1:n)];
xs=[xs aux3(1:n)];
aa(2)=1;
bb(2)=1;

% CS Ibiuna
nm(3)=4;                      % max=4
aux1=[3.3 3.2 3.1 3.0];
aux2=0.90*ones(1,4);
aux3=[1.78 1.74 1.70 1.66];
n=nm(3);
sn=[sn aux1(1:n)];
fp=[fp aux2(1:n)];
xs=[xs aux3(1:n)];
% não tem custo de potência, pois funciona so compensando reativos

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Barras sem geração
sn=[sn zeros(1,17-3-1)];
fp=[fp zeros(1,17-3-1)];
xs=[xs zeros(1,17-3-1)];
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% UHE Emborcação
nm(17)=2;                     % max=4   
aux1=[3.00 2.98 2.96 2.94];
aux2=0.975*ones(1,4);
aux3=[0.93 0.90 0.87 0.84];
n=nm(17);
sn=[sn aux1(1:n)];
fp=[fp aux2(1:n)];
xs=[xs aux3(1:n)];
aa(17)=1;
bb(17)=1;

% UHE Jaguara
nm(18)=4;                     % max=4
aux1=[1.04 1.02 1.00 0.98];
aux2=0.95*ones(1,4);
aux3=[0.99 0.98 0.97 0.96];
n=nm(18);
sn=[sn aux1(1:n)];
fp=[fp aux2(1:n)];
xs=[xs aux3(1:n)];
aa(18)=1;
bb(18)=1;

% UHE Nova Ponte
nm(19)=3;                     % max=3   
aux1=[1.70 1.72 1.68];
aux2=0.975*ones(1,3);
aux3=[1.02 1.00 0.98];
n=nm(19);
sn=[sn aux1(1:n)];
fp=[fp aux2(1:n)];
xs=[xs aux3(1:n)];
aa(19)=1;
bb(19)=1;

% UHE São Simão
nm(20)=5;                     % max=6
aux1=[2.86 2.84 2.82 2.80 2.78 2.76];
aux2=0.95*ones(1,6);
aux3=[0.98 0.96 0.94 0.92 0.90 0.88];
n=nm(20);
sn=[sn aux1(1:n)];
fp=[fp aux2(1:n)];
xs=[xs aux3(1:n)];
aa(20)=1;
bb(20)=1;

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Barras sem geração
sn=[sn zeros(1,26-20-1)];
fp=[fp zeros(1,26-20-1)];
xs=[xs zeros(1,26-20-1)];
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% UHE Água Vermelha
nm(26)=4;                     % max=6   
aux1=[2.38 2.36 2.34 2.32 2.30 2.28];
aux2=0.95*ones(1,6);
aux3=[0.94 0.92 0.90 0.88 0.86 0.84];
n=nm(26);
sn=[sn aux1(1:n)];
fp=[fp aux2(1:n)];
xs=[xs aux3(1:n)];
aa(26)=1;
bb(26)=1;

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Barras sem geração
sn=[sn zeros(1,29-26-1)];
fp=[fp zeros(1,29-26-1)];
xs=[xs zeros(1,29-26-1)];
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% UHE Gov. Bento Munhoz
nm(29)=3;                     % max=4
aux1=[4.21 4.19 4.17 4.12];
aux2=0.95*ones(1,4);
aux3=[0.52 0.50 0.48 0.46];
n=nm(29);
sn=[sn aux1(1:n)];
fp=[fp aux2(1:n)];
xs=[xs aux3(1:n)];
aa(29)=1;
bb(29)=1;

% UHE Salto Caxias
nm(30)=3;                     % max=3   
aux1=[3.15 3.10 3.05];
aux2=0.95*ones(1,3);
aux3=[0.90 0.88 0.86];
n=nm(30);
sn=[sn aux1(1:n)];
fp=[fp aux2(1:n)];
xs=[xs aux3(1:n)];
aa(30)=1;
bb(30)=1;

% UHE Segredo
nm(31)=3;                     % max=4
aux1=[3.21 3.18 3.15 3.12];
aux2=0.95*ones(1,4);
aux3=[0.90 0.88 0.86 0.84];
n=nm(31);
sn=[sn aux1(1:n)];
fp=[fp aux2(1:n)];
xs=[xs aux3(1:n)];
aa(31)=1;
bb(31)=1;

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Barras sem geração
sn=[sn zeros(1,43-31-1)];
fp=[fp zeros(1,43-31-1)];
xs=[xs zeros(1,43-31-1)];
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% UHE Ita
nm(43)=5;                     % max=5   
aux1=[2.99 2.96 2.93 2.90 2.87];
aux2=0.975*ones(1,5);
aux3=[1.16 1.14 1.12 1.10 1.08];
n=nm(43);
sn=[sn aux1(1:n)];
fp=[fp aux2(1:n)];
xs=[xs aux3(1:n)];
aa(43)=1;
bb(43)=1;

% UHE Machadinho
nm(44)=3;                     % max=3
aux1=[3.85 3.80 3.75];
aux2=0.95*ones(1,3);;
aux3=[0.62 0.58 0.54];
n=nm(44);
sn=[sn aux1(1:n)];
fp=[fp aux2(1:n)];
xs=[xs aux3(1:n)];
aa(44)=1;
bb(44)=1;

% UHE Salto Osorio
nm(45)=2;                     % max=4   
aux1=[1.86 1.84 1.82 1.80];
aux2=0.90*ones(1,4);
aux3=[1.22 1.20 1.18 1.16];
n=nm(45);
sn=[sn aux1(1:n)];
fp=[fp aux2(1:n)];
xs=[xs aux3(1:n)];
aa(45)=1;
bb(45)=1;

% UHE Salto Santiago
nm(46)=3;                     % max=4   
aux1=[3.58 3.56 3.54 3.52];
aux2=0.975*ones(1,4);
aux3=[0.94 0.92 0.90 0.88];
n=nm(46);
sn=[sn aux1(1:n)];
fp=[fp aux2(1:n)];
xs=[xs aux3(1:n)];
aa(46)=1;
bb(46)=1;

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Barras sem geração
sn=[sn zeros(1,65-46)];
fp=[fp zeros(1,65-46)];
xs=[xs zeros(1,65-46)];
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

nt=nb+sum(nm)-sum(nm>0);      % número de máquinas 
nt=full(nt);
miv=[1:nt]';                  % machine index vector
 
% curvas de capabilidade
cap

% Limites de reativos nas unidades geradoras
qgmin=zeros(nt,1);
qgmax=zeros(nt,1);
qgmin(ger)=limites(1,:);
qgmax(ger)=limites(2,:);

% Calcula limites de reativos das barras
aux=nm>1;
aux=aux.*(nm-1);
is=1:nb;
for i=2:nb
    is(i:nb)=is(i:nb)+aux(i-1);
end
for i=1:nb
    qgmaxt(i)=sum(qgmax(is(i):is(i)+aux(i)));
    qgmint(i)=sum(qgmin(is(i):is(i)+aux(i)));
    snt(i)=sum(sn(is(i):is(i)+aux(i)));
end
qgmaxt=qgmaxt';
qgmint=qgmint';

% Limite de ativos das unidades geradoras
pgmax=sparse(zeros(nt,1));
pgmin=sparse(zeros(nt,1));
pgmaxt=[];
pgmint=[];

% Limites das regiões do custo de potência reativa
qg01=0.3*qgmaxt;
qg12=0.7*qgmaxt;
qg03=0.3*qgmint;
qg34=0.7*qgmint;

% Coeficientes das curvas de custo de geração                          

xx=1.00*ones(nb,1);           % Coef angular da primeira regiao do custo de potencia reativa
yy=2.50*ones(nb,1);           % Coef angular da segunda regiao do custo de potencia reativa
zz=3.64*ones(nb,1);           % Coef angular da terceira regiao do custo de potencia reativa

vmax=1.05*ones(nb,1);         % max voltage magnitude vector
vmin=0.95*ones(nb,1);         % min voltage magnitude vector


amin=ones(nl,1);
amax=ones(nl,1);

phimin=zeros(nl,1);
phimax=zeros(nl,1);

xmax=x;
xmin=x;

flmax=1./x*0.7;
flmin=-flmax;

warning on

